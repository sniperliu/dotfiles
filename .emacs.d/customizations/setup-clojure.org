#+TITLE: Clojure development workflow configuration

* Cojure mode

#+begin_src emacs-lisp
(use-package clojure-mode
  :ensure t
  :init
  (add-hook 'clojure-mode-hook 'yas-minor-mode)
  (add-hook 'clojure-mode-hook 'linum-mode)
  ;; (add-hook 'clojure-mode-hook 'subword-mode)
  ;; (add-hook 'clojure-mode-hook 'smartparens-mode)
  (add-hook 'clojure-mode-hook 'rainbow-delimiters-mode)
  (add-hook 'clojure-mode-hook 'eldoc-mode)
  ;; (add-hook 'clojure-mode-hook 'idle-highlight-mode))
  )
#+end_src

* Paredit
#+begin_src emacs-lisp
(use-package paredit
  :ensure t
  :config
  (add-hook 'lisp-mode-hook       'paredit-mode)
  (add-hook 'emacs-lisp-mode-hook 'paredit-mode)
  (add-hook 'clojure-mode-hook    'paredit-mode)
  (add-hook 'cider-repl-mode-hook 'paredit-mode))

(use-package parinfer
  :ensure t
  :bind
  (("C-," . parinfer-toggle-mode))
  :init
  (progn
    (setq parinfer-extensions
          '(defaults       ; should be included.
            pretty-parens  ; different paren styles for different modes.
            paredit        ; Introduce some paredit commands.
            smart-tab      ; C-b & C-f jump positions and smart shift with tab & S-tab.
            smart-yank))   ; Yank behavior depend on mode.
    (add-hook 'clojure-mode-hook #'parinfer-mode)
    (add-hook 'emacs-lisp-mode-hook #'parinfer-mode)
    (add-hook 'common-lisp-mode-hook #'parinfer-mode)
    (add-hook 'scheme-mode-hook #'parinfer-mode)
    (add-hook 'lisp-mode-hook #'parinfer-mode)))
#+end_src

* Cider

#+begin_src emacs-lisp
(use-package cider
  :ensure t
  :init
  ;; Clojure mode
  (setq clojure-indent-style :always-indent)
  ;; REPL history file
  (setq cider-repl-history-file (format "%s/.cider-history" user-emacs-directory))
  ;; nicer font lock in REPL
  (setq cider-repl-use-clojure-font-lock t)
  ;; result prefix for the REPL
  (setq cider-repl-result-prefix ";; => ")
  ;; never ending REPL history
  (setq cider-repl-wrap-history t)
  ;; looong history
  (setq cider-repl-history-size 3000)
  ;; nice pretty printing
  (setq cider-repl-use-pretty-printing t)

  (add-hook 'cider-mode-hook 'clj-refactor-mode)
  ;; eldoc for clojure
  (add-hook 'cider-mode-hook 'eldoc-mode)

  (add-hook 'cider-repl-mode-hook 'rainbow-delimiters-mode)

  ;; error buffer not popping up
  (setq cider-show-error-buffer nil)

  ;; company mode for completion
  (add-hook 'cider-repl-mode-hook 'company-mode)
  (add-hook 'cider-mode-hook      'company-mode))
#+end_src

* clj-refactor

#+begin_src emacs-lisp
(use-package clj-refactor
  :ensure t
  :init
  (add-hook 'clojure-mode-hook
    (lambda ()
      (clj-refactor-mode 1)
      ;; insert keybinding setup here
      (cljr-add-keybindings-with-prefix "C-c RET")))
  (add-hook 'clojure-mode-hook #'yas-minor-mode)
  ;; no auto sort
  (setq cljr-auto-sort-ns nil)
  ;; do not prefer prefixes when using clean-ns
  (setq cljr-favor-prefix-notation nil))
#+end_src

* snippet

#+begin_src emacs-lisp
(use-package clojure-snippets
  :ensure t
  :after (yasnippet))
#+end_src

* highlight

#+begin_src emacs-lisp
(use-package hl-sexp
  :ensure t
  :config
  (add-hook 'clojure-mode-hook    'hl-sexp-mode)
  (add-hook 'lisp-mode-hook       'hl-sexp-mode)
  (add-hook 'emacs-lisp-mode-hook 'hl-sexp-mode))
#+end_src

* Arcadia

#+begin_src emacs-lisp
(use-package inf-clojure
  :ensure t
  :config
  (defcustom arcadia-repl-port 5555
    "Port to connect to Arcadia repl.")

  (defun arcadia-repl ()
    "Attempts to connect to a running Arcadia instance over the Arcadia socket-repl."
    (setq completion-at-point-functions nil)
    (interactive)
    (inf-clojure-connect "localhost" arcadia-repl-port))


  ;; inf-clojure's argslists eldoc support spams the Arcadia repl
  ;; and slows down emacs. This (removable) empty wrapper function is a
  ;; quick kludge to disable it.
  (defun arcadia-inf-clojure-eldoc-setup-wrapper (orig-fun &rest args)
    )

  ;; Temporary hack that disables eldoc for inf-clojure.
  (advice-add 'inf-clojure-eldoc-setup :around #'arcadia-inf-clojure-eldoc-setup-wrapper))
#+end_src
